(function(window){'use strict';function define_Fireworks(){function Fireworks(particlesNum,partSpeed,speedVariance,friction=8,bindClick=true,showTarget=false,lineWidth=2,lzySlow=0){var self=this;var rand=function(rMi,rMa){return~~((Math.random()*(rMa-rMi+1))+rMi);}
var hitTest=function(x1,y1,w1,h1,x2,y2,w2,h2){return!(x1+w1<x2||x2+w2<x1||y1+h1<y2||y2+h2<y1);};window.requestAnimFrame=function(){if(document.hidden)return false;return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)}}();window.cancelRequestAnimFrame=(function(){return window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.clearTimeout;})();self.init=function(){self.canvas=document.createElement('canvas');self.canvas.width=self.cw=document.documentElement.clientWidth||document.body.clientWidth;self.canvas.height=self.ch=document.documentElement.clientHeight||document.body.clientHeight;self.particles=[];self.partCount=particlesNum||150;self.fireworks=[];self.mx=self.cw/2;self.my=self.ch/2;self.currentHue=30;self.partSpeed=partSpeed||5;self.partSpeedVariance=speedVariance||10;self.partWind=50;self.partFriction=friction||5;self.partGravity=1;self.hueMin=0;self.hueMax=360;self.fworkSpeed=lzySlow>2?lzySlow:4;self.fworkAccel=10;self.hueVariance=30;self.flickerDensity=25;self.showShockwave=false;self.showTarget=showTarget||false;self.clearAlpha=25;self.lzySlow=lzySlow;document.body.appendChild(self.canvas);self.ctx=self.canvas.getContext('2d');self.ctx.lineCap='round';self.ctx.lineJoin='round';self.lineWidth=1;if(bindClick)self.bindEvents();self.canvasLoop();self.canvas.onselectstart=function(){return false;};self.lzyShooting=[];self.lzyAnimRequst=0;self.lzyInterval=[];self.lzyFireQueue={random:[],heart:{0:[self.cw/2,self.ch/2,self.cw/2-45*2.72,self.ch/2-45*3.06],1:[self.cw/2,self.ch/2,self.cw/2+45*2.72,self.ch/2-45*3.06],2:[self.cw/2,self.ch/2,self.cw/2-45*3.46,self.ch/2-45*2.01],3:[self.cw/2,self.ch/2,self.cw/2+45*3.46,self.ch/2-45*2.01],4:[self.cw/2,self.ch/2,self.cw/2-45*3.08,self.ch/2-45*0.30],5:[self.cw/2,self.ch/2,self.cw/2+45*3.08,self.ch/2-45*0.30],6:[self.cw/2,self.ch/2,self.cw/2-45*1,self.ch/2-45*2.43],7:[self.cw/2,self.ch/2,self.cw/2+45*1,self.ch/2-45*2.43],8:[self.cw/2,self.ch/2,self.cw/2,self.ch/2+45*3],9:[self.cw/2,self.ch/2,self.cw/2-45*2.28,self.ch/2+45*1],10:[self.cw/2,self.ch/2,self.cw/2+45*2.28,self.ch/2+45*1],11:[self.cw/2,self.ch/2,self.cw/2-45*1.5,self.ch/2+45*2.25],12:[self.cw/2,self.ch/2,self.cw/2+45*1.5,self.ch/2+45*2.25],13:[self.cw/2,self.ch/2,self.cw/2,self.ch/2-45*2]}}
var lzyBuffer=false,gapInterval=0;document.addEventListener('visibilitychange',function(){if(document.hidden){gapInterval=setTimeout(function(){for(let i=0;i<self.lzyShooting.length;i++){clearInterval(self.lzyShooting[i]);}
for(let key in self.lzyInterval){clearInterval(self.lzyInterval[key][0]);}
lzyBuffer=true;},999);}else{if(!lzyBuffer){clearTimeout(gapInterval);}else{for(let k in self.lzyInterval){self.fireInterval(eval(k),self.lzyInterval[k][1]);}
if(self.lzyShooting.length>0){self.lzyShooting=[];self.lzyRandomShoot();}
lzyBuffer=false;}}});};self.createParticles=function(x,y,hue){var countdown=self.partCount;while(countdown--){var newParticle={x:x,y:y,coordLast:[{x:x,y:y},{x:x,y:y},{x:x,y:y}],angle:rand(0,360),speed:rand(((self.partSpeed-self.partSpeedVariance)<=0)?1:self.partSpeed-self.partSpeedVariance,(self.partSpeed+self.partSpeedVariance)),friction:1-self.partFriction/100,gravity:self.partGravity/2,hue:rand(hue-self.hueVariance,hue+self.hueVariance),brightness:rand(50,80),alpha:rand(40,100)/100,decay:rand(10,50)/1000,wind:(rand(0,self.partWind)-(self.partWind/2))/25,lineWidth:self.lineWidth};self.particles.push(newParticle);}};self.updateParticles=function(){var i=self.particles.length;while(i--){var p=self.particles[i];var radians=p.angle*Math.PI/180;var vx=Math.cos(radians)*p.speed;var vy=Math.sin(radians)*p.speed;p.speed*=p.friction;p.coordLast[2].x=p.coordLast[1].x;p.coordLast[2].y=p.coordLast[1].y;p.coordLast[1].x=p.coordLast[0].x;p.coordLast[1].y=p.coordLast[0].y;p.coordLast[0].x=p.x;p.coordLast[0].y=p.y;p.x+=vx;p.y+=vy;p.y+=p.gravity;p.angle+=p.wind;p.alpha-=p.decay;if(!hitTest(0,0,self.cw,self.ch,p.x-p.radius,p.y-p.radius,p.radius*2,p.radius*2)||p.alpha<.05){self.particles.splice(i,1);}};};self.drawParticles=function(){var i=self.particles.length;while(i--){var p=self.particles[i];var coordRand=(rand(1,3)-1);self.ctx.beginPath();self.ctx.moveTo(Math.round(p.coordLast[coordRand].x),Math.round(p.coordLast[coordRand].y));self.ctx.lineTo(Math.round(p.x),Math.round(p.y));self.ctx.closePath();self.ctx.strokeStyle='hsla('+p.hue+', 100%, '+p.brightness+'%, '+p.alpha+')';self.ctx.stroke();if(self.flickerDensity>0){var inverseDensity=50-self.flickerDensity;if(rand(0,inverseDensity)===inverseDensity){self.ctx.beginPath();self.ctx.arc(Math.round(p.x),Math.round(p.y),rand(p.lineWidth,p.lineWidth+3)/2,0,Math.PI*2,false)
self.ctx.closePath();var randAlpha=rand(50,100)/100;self.ctx.fillStyle='hsla('+p.hue+', 100%, '+p.brightness+'%, '+randAlpha+')';self.ctx.fill();}}};};self.createFireworks=function(startX,startY,targetX,targetY){var newFirework={x:startX,y:startY,startX:startX,startY:startY,hitX:false,hitY:false,coordLast:[{x:startX,y:startY},{x:startX,y:startY},{x:startX,y:startY}],targetX:targetX,targetY:targetY,speed:self.fworkSpeed,angle:Math.atan2(targetY-startY,targetX-startX),shockwaveAngle:Math.atan2(targetY-startY,targetX-startX)+(90*(Math.PI/180)),acceleration:self.fworkAccel/100,hue:self.currentHue,brightness:rand(50,80),alpha:rand(50,100)/100,lineWidth:self.lineWidth};self.fireworks.push(newFirework);};self.updateFireworks=function(){var i=self.fireworks.length;while(i--){var f=self.fireworks[i];self.ctx.lineWidth=f.lineWidth;var vx=Math.cos(f.angle)*f.speed,vy=Math.sin(f.angle)*f.speed;f.speed*=1+f.acceleration;f.coordLast[2].x=f.coordLast[1].x;f.coordLast[2].y=f.coordLast[1].y;f.coordLast[1].x=f.coordLast[0].x;f.coordLast[1].y=f.coordLast[0].y;f.coordLast[0].x=f.x;f.coordLast[0].y=f.y;if(self.lzySlow>1){if(Math.abs(f.startY-f.y)<Math.abs(f.targetY-f.startY)/2)
f.speed*=1+f.acceleration;else if(Math.abs(f.targetY-f.y)<Math.abs(f.targetY-f.startY)/8){f.speed=(2+f.speed)/2;}
else{f.speed=(self.fworkSpeed+f.speed)/2;}}
else if(!self.lzySlow)f.speed*=1+f.acceleration;else f.speed=1;if(f.startX>=f.targetX){if(f.x+vx<=f.targetX){f.x=f.targetX;f.hitX=true;}else{f.x+=vx;}}else{if(f.x+vx>=f.targetX){f.x=f.targetX;f.hitX=true;}else{f.x+=vx;}}
if(f.startY>=f.targetY){if(f.y+vy<=f.targetY){f.y=f.targetY;f.hitY=true;}else{f.y+=vy;}}else{if(f.y+vy>=f.targetY){f.y=f.targetY;f.hitY=true;}else{f.y+=vy;}}
if(f.hitX&&f.hitY){self.createParticles(f.targetX,f.targetY,f.hue);self.fireworks.splice(i,1);}};};self.drawFireworks=function(){var i=self.fireworks.length;self.ctx.globalCompositeOperation='lighter';while(i--){var f=self.fireworks[i];self.ctx.lineWidth=f.lineWidth;var coordRand=(rand(1,3)-1);self.ctx.beginPath();self.ctx.moveTo(Math.round(f.coordLast[coordRand].x),Math.round(f.coordLast[coordRand].y));self.ctx.lineTo(Math.round(f.x),Math.round(f.y));self.ctx.closePath();self.ctx.strokeStyle='hsla('+f.hue+', 100%, '+f.brightness+'%, '+f.alpha+')';self.ctx.stroke();if(self.showTarget){self.ctx.save();self.ctx.beginPath();self.ctx.arc(Math.round(f.targetX),Math.round(f.targetY),rand(1,8),0,Math.PI*2,false)
self.ctx.closePath();self.ctx.lineWidth=1;self.ctx.stroke();self.ctx.restore();}
if(self.showShockwave){self.ctx.save();self.ctx.translate(Math.round(f.x),Math.round(f.y));self.ctx.rotate(f.shockwaveAngle);self.ctx.beginPath();self.ctx.arc(0,0,1*(f.speed/5),0,Math.PI,true);self.ctx.strokeStyle='hsla('+f.hue+', 100%, '+f.brightness+'%, '+rand(25,60)/100+')';self.ctx.lineWidth=f.lineWidth;self.ctx.stroke();self.ctx.restore();}};};self.bindEvents=function(){window.addEventListener('resize',function(){clearTimeout(self.timeout);self.timeout=setTimeout(function(){self.canvas.width=self.cw=document.documentElement.clientWidth||document.body.clientWidth;self.canvas.height=self.ch=document.documentElement.clientHeight||document.body.clientHeight;self.ctx.lineCap='round';self.ctx.lineJoin='round';},100);});self.canvas.addEventListener('click',function(e){self.mx=e.pageX-self.canvas.offsetLeft;self.my=e.pageY-self.canvas.offsetTop;self.currentHue=rand(self.hueMin,self.hueMax);self.createFireworks(self.cw/2,self.ch,self.mx,self.my);});}
self.clear=function(){self.particles=[];self.fireworks=[];self.ctx.clearRect(0,0,self.cw,self.ch);};self.canvasLoop=function(gapTime=false){self.ctx.globalCompositeOperation='destination-out';self.ctx.fillStyle='rgba(0,0,0,'+self.clearAlpha/100+')';self.ctx.fillRect(0,0,self.cw,self.ch);self.updateFireworks();self.updateParticles();self.drawFireworks();self.drawParticles();self.lzyAnimRequst=window.requestAnimFrame(self.canvasLoop);};self.lzyShoot=function(queueFire,interval=false){interval===true?interval=188:interval;var i=0,line=setInterval(function(){if(i>=Object.keys(queueFire).length){clearInterval(line);return true;}self.createFireworks(queueFire[i][0],queueFire[i][1],queueFire[i][2],queueFire[i][3]);self.currentHue=rand(1,360);++i},interval);}
self.fireInterval=function(fctName,gap){var a=setInterval(fctName,gap);self.lzyInterval[fctName.name]=[a,gap];return a;}
self.delInterval=function(){for(let k in self.lzyInterval){window.clearInterval(self.lzyInterval[k][0]);}
self.lzyInterval=[];}
self.lzyRandomShoot=function(control=1,radius=0){var i,gap=1688;if(control==0){for(i=0;i<self.lzyShooting.length;i++){clearInterval(self.lzyShooting[i]);}
self.lzyShooting=[];return true;}
else if(control>1)gap=control||1688;else if(self.cw>867)radius=radius||188;else radius=radius||49;self.lzyShooting.push(setInterval(function(){self.lzyFireQueue.random={0:[0,self.ch,self.cw/2+Math.random()*radius,self.ch/9+Math.random()*radius],1:[self.cw/5,self.ch,self.cw/12*5-Math.random()*radius,self.ch/12*5-Math.random()*radius],2:[self.cw/4,self.ch,self.cw/12*7-Math.random()*radius,self.ch/8+Math.random()*radius],3:[self.cw/3,self.ch,self.cw/5+Math.random()*radius,self.ch/4+Math.random()*radius],4:[self.cw/5*2,self.ch,self.cw/4*3-Math.random()*radius,self.ch/4+Math.random()*radius],5:[self.cw/2,self.ch,self.cw/24*7-Math.random()*radius,self.ch/2-Math.random()*radius],6:[self.cw/3*2,self.ch,self.cw/3-Math.random()*radius,self.ch/24*11-Math.random()*radius],7:[self.cw/4*3,self.ch,self.cw/5*3-Math.random()*radius,self.ch/3+Math.random()*radius],8:[self.cw/5*4,self.ch,self.cw/9+Math.random()*radius,self.ch/12*5-Math.random()*radius],9:[self.cw,self.ch,self.cw/9*7+Math.random()*radius,self.ch/24*5+Math.random()*radius]};self.lzyShoot(self.lzyFireQueue.random,true);},gap));return self.lzyShooting[self.lzyShooting.length-1];}
self.init();}
return Fireworks;};if(typeof(Fireworks)=="undefined"){window.Fireworks=define_Fireworks();}
else{console.error('Fireworks is already defined!')}})(window);